<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>Revisiting the BBB Bispectrum Project</title>
    <link rel="stylesheet" type="text/css" href="style.css">
    <!-- Load up MathJax for math notation -->
    <script type="text/x-mathjax-config">
        MathJax.Hub.Config({
            TeX: { equationNumbers: { autoNumber: "AMS" } }
        });
    </script>
    <script type="text/javascript" src="../mathjax/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
    </script>
</head>

<body>
    <!-- Add custom pager script -->
    <script type="text/javascript" src="scripts/pager.js"></script>
    <link rel="stylesheet" type="text/css" href="scripts/pager.css">

    <header>
        <h1>Revisiting the BBB Bispectrum Project</h1>
        <time datetime="2025-10-16" class="published updated">2025 October 16</time> â€”
        Tongtian (Tom) Liu
    </header>

    <hr>

    <section>
        <h2>Introduction</h2>
        Paper page for current draft is here:
        <a href="https://bicep.rc.fas.harvard.edu/~bicep2/papers/2025_bbb_bispec/">Constraint on non-Gaussianity of inflationary gravitational waves from B-mode bispectrum</a>
       <p><strong>Summary:</strong>
        We reproduce Toshiya's BBB bispectrum results to verify our estimator for the standard BK sims. 
        We then add a nongaussian part, scaled by \(f_{NL}\) to test the estimator's ability to recover the injected nongausianity.
        The estimator currently does not appear to accurately recover injected large \(f_{NL}\).
    </p>

        <p>This posting builds upon previous updates:</p>
        <ul>
            <li><a href="../20160000_namikawa/20231117_bispec/">2023-11-17: Polarization Bispectrum Analysis</a></li>
            <li><a href="../wip_nonGaussianity/">2022-07-18: Equilateral fNL from B18 95GHz Bispectrum</a></li>
            <li><a href="../20160000_namikawa/20210520_bispec/">2021-05-20: Equilateral B-mode bispectrum analysis</a></li>
            <li><a href="../20200703_bispec/">2020-07-03: Polarization Bispectrum Analysis</a></li>
            <li><a href="../20190805_bispec/">2019-08-05: Polarization Bispectrum Analysis</a></li>
        </ul>
        <p>
        While the simplest inflationary models predict that primordial fluctuations should be nearly Gaussian, 
        any deviations from this is captured by higher-order correlation functions like the bispectrum, and it can constrain more complex 
        inflationary scenarios. The \(B\)-mode bispectrum (BBB) provides a way to search for 
        primordial non-Gaussianity, quantified by the parameter \({f_{NL}}\). 
        A non-zero \(f_{NL}\) could indicate different models of inflation, including thos with axion fields.
    </p>
    <p>
        <a href="https://arxiv.org/pdf/1905.05697">Planck's 2019 paper</a> provides a more thorough definition of the different types of bispectra 
        (equilateral, local, orthogonal) and their relationship with the \(f_{NL}\) parameter.
        Toshiya's <a href="https://www.overleaf.com/project/66212da42d93d0485590c09c">paper draft</a> and previous postings outline the 
        derivations for calculating the specific bispectrum and \(f_{NL}\) that BICEP is sensitive to, namely the equilateral B-mode bispectrum, 
        which we refer to as \(f_{NL}^{tens}\).
        </p>
        <p>
            To summarize, Toshiya's pipeline generates three different sets of \(a_{lm}\)'s: \(a_{lm}^{BICEP}\), \(a_{lm}^{G}\), and \(a_{lm}^{NG}\).
            Where \(a_{lm}^{BICEP}\) represents the standard BICEP sims with 499 realizations, including dust and noise,  \(a_{lm}^{G}\) is a set of guassian simulations
            without dust or noise, and \(a_{lm}^{NG}\) represents the non-gaussian components. To inject nonGaussianity, we have, 
            \(a^{tot}_{lm} = \sqrt{r}  a_{lm}^{G} + A\frac{f_{NL}^{tens}a_{lm}^{NG}}{r}\)
            where \(r\) is the tensor to scalar ratio, and \(A=10^{-50}\) is a constant scaling factor used when saving files 
            (potentially for readability reasons?). 
        </p>
        <p>
            The \(a_{lm}\)'s are then used to calculate filtered maps. The maps are binned and used to extract the binned BBB bispectra \(b_{ijk}\),
            where \(ijk\) refers to the combination of the BICEP bins.
            As stated in eq (26) of <a href="https://www.overleaf.com/project/66212da42d93d0485590c09c">paper draft</a>, 
            the calculated bispectra are then run through the estimator as calculated by:
        </p>
        <p>
   \(
   \begin{align}
   f_{\rm NL}^{\rm tens} = \sum_{I,J=i,j,k} b_I^{f_{\rm NL}=1} {\rm Cov}^{-1}_{IJ}b_J \,.
   \end{align}
   \)
  </p>
<p>\(I\) and \(J\) are a pair of three multipole bins, \((i,j,k)\), \(b_I^{f_{\rm NL}=1}\) is the binned bispectrum obtained 
    from the simulation with \(f^{\rm tens}_{\rm NL}=1\), and \(\rm{Cov}_{IJ}\) is the covariance matrix of the binned bispectrum estimated 
    from the standard simulation (calculated from \(a_{lm}^{BICEP}\)). </p>
    </section>

    <section>
    <h2>Reproducing Toshiya's Original Results</h2>
     We recalculate the \(f_{NL}\) used in the paper and previous postings by refactoring the existing estimator, 
     then running it with the saved \(b_{ijk}\) files from <code>/n/holylfs04/LABS/kovac_lab/users/namikawa/B33y/bispec_bbb/</code>

        <figure>
            <img alt="Remade fNL histograms" id="fnl" src="#" width="750" height="500"
                onerror="javascript:this.src='dne.png'" />
            <figcaption>
               
                Recreating histograms in the Overleaf draft Fig. 1. We produce plots for all of the saved bispectrum files, 
                including different multipole ranges, jackknife tests, and bin numbers. The plots show the mean and spread 
                of the recovered fNL parameter over 499 simulation realizations.

                The parameters used in Fig. 1 correspond to bin num = 7, 8, 9, ell range = 20-350, full covariance matrices, and no jackknife. 
            </figcaption>

            <script type="text/javascript">
                pager.link("#fnl", {
                    'fNL sim value|scaling':[
                        'fNL = 0|',
                    ],
                    'Bin Num|bn': [
                        '7|7',
                        '8|8',
                        '9|9',
                        '10|10',
                        '11|11',
                        '16|16',
                    ],
                    'Ell Range|oL':[
                        '1-300|1-300',
                        '20-350|20-350',
                        '20-580|20-580',
                        '30-350|30-350',
                    ],
                    'Zeroed Off diagonal covariance matrices|zerodiag':[
                        'True|True',
                        'False|False',
                    ],
                    'Frequency|nu':[
                        '100|100'
                    ],
                    'Jackknife|jk':[
                        'None|',
                        'j1|_j1',
                        'j2|_j2',
                        'j3|_j3',
                        'j4|_j4',
                        'j5|_j5',
                        'j6|_j6',
                        'j7|_j7',
                        'j8|_j8',
                        'j9|_j9',
                        'ja|_ja',
                        'jb|_jb',
                        'jc|_jc',
                        'jd|_jd',
                        'je|_je',

                    ],

                }, function (params) {
                    let dirbase = '/liuto/home/GitHub/bispec_project/';
                    dirbase = dirbase + 'fnl_figs' + params.scaling + '/'
                    let filename = 'b3d_1var_nu' + params.nu + 
                                '_lx0_nobl_lcdm' + params.jk + 
                                '_dp1102_oL' + params.oL + 
                                '_b' + params.bn + 
                                '_diag' + params.zerodiag
                    let filepath = dirbase + filename + '.png'
                    console.log(filepath)
                    return filepath;
                });

                pager.setparams({ 
                    'bn': '9',
                     'oL': '20-350',
                     'zerodiag': 'False',
                     'nu': '100',
                     'jk':'',
                     'scaling':'',
                }   

                );
            </script>
        </figure>
        <p>
We see that we are able to successfully recreate Toshiya's original histograms from his generated \(b_{ijk}\) files. 
These bispectrum files use \(a_{lm}^{BICEP}\), and thus contain no non-gaussianity. 
Accordingly, the histograms show \(f_{NL}\) to be consistent with zero with a spread around 800-900, 
which is better than the B-mode bispectrum constraint cited by <a href="https://arxiv.org/pdf/1905.05697">Planck's 2019 paper</a> 
(I wasn't able to find the specific constraint that corresponded to our case). </p>
</section>
<section>
<h2>Injecting Nongaussianity</h2>
<p>The next step of the analysis is to inject non-gaussianity into the simulations and check whether the estimator is able to recover the injected values. 
    Again, we have \(a^{tot}_{lm} = \sqrt{r}  a_{lm}^{G} + A\frac{f_{NL}^{tens}a_{lm}^{NG}}{r}\)
</p>
<p>
However, to account for dust and noise in the data, we let \(a^{tot}_{lm} = a^{BICEP}_{lm} + \sqrt{r}  a_{lm}^{G} + A\frac{f_{NL}^{tens}a_{lm}^{NG}}{r}\). 
We note that \(a^{BICEP}_{lm}\) does already contain the gaussian portions of the simulation, so that adding \(a_{lm}^{G}\) on top of the BICEP sims may 
double count the gaussian part. However, upon testing the estimator with \(f_{NL}=0\), we notice that the difference in the estimator's results are 
negligible when looking at \(a^{tot}_{lm} = a^{BICEP}_{lm} + \sqrt{r}  a_{lm}^{G}\) versus \(a^{tot}_{lm} = a^{BICEP}_{lm} \).
</p>
<p>
The files are generated in fortran from <code>/n/home08/liuto/bk_analysis/cmbrectool/bispec/bispec_3d/main.f90</code>, 
where the \(f_{NL}\) and other parameters are defined in <code>params_b33y.ini</code>, run by <code>./exe params_b33y.ini</code>. 
The files are then saved in <code>/n/holylfs04/LABS/kovac_lab/users/liuto/B33y/bispec_bbb/</code>.
</p>
        <figure>
            <img alt="Injected fNL histograms" id="inj" src="#" width="750" height="500"
                onerror="javascript:this.src='dne.png'" />
            <figcaption>
               New histograms with injected nongaussianity for different values of fNL. In our initial tests, 
               we only consider bin num = 9 and test limited number of ell ranges. In the alm definition option, 
               alm refers to \(a^{tot}_{lm}\), alm_bicep refers to \(a^{BICEP}_{lm} \), glm refers to \(\sqrt{r}  a_{lm}^{G}\), 
               and flm refers to \( A \frac{a_{lm}^{NG}}{r}\).
                
               The second ell range is there to ensure that the issues are not specific to one ell range configuration.
               The plots show the mean and spread 
                of the recovered fNL parameter over 499 simulation realizations.


            </figcaption>

            <script type="text/javascript">
                pager.link("#inj", {
                    'fNL injected value|scaling2':[
                        'fNL = 0|0000',
                        'fNL = 1|0001',
                        'fNL = 10|0010',
                        'fNL = 32|0032',
                        'fNL = 100|0100',
                        'fNL = 1000|1000',
                    ],
                    'Bin Num|bn2': [
                        '9|9',
                    ],
                    'alm definition|config':[
                        'alm = alm_bicep + glm + flm * fnl|_scaled',
                        'alm = alm_bicep + flm * fnl|_scaled2',
                        'alm = glm + flm * fnl|_scaled3',
                    ],
                    'Ell Range|oL2':[
                        '30-350 |30-350',
                        '20-350 |20-350',
                    ],
                    'Zeroed Off diagonal covariance matrices|zerodiag':[
                        'True|True',
                        'False|False',
                    ],
                    'Frequency|nu':[
                        '100|100'
                    ],
                    'Jackknife|jk2':[
                        'None|',
                    ],

                }, function (params) {
                    let dirbase = '/liuto/home/GitHub/bispec_project/';
                    dirbase = dirbase + 'fnl_figs' + params.config + '/'
                    let filename = 'b3d_1var_nu' + params.nu + 
                                '_lx0_nobl_lcdm' + params.jk2 + 
                                '_dp1102_oL' + params.oL2 + 
                                '_b' + params.bn2 + 
                                '_fnl' + params.scaling2 +
                                '_diag' + params.zerodiag 
                    let filepath = dirbase + filename + '.png'
                    console.log(filepath)
                    return filepath;
                });

                pager.setparams({ 
                    'bn2': '9',
                     'oL2': '20-350',
                     'config': '_scaled',
                     'zerodiag': 'False',
                     'nu': '100',
                     'jk2':'',
                     'scaling2':'0001',
                     'cov':'_scaled'
                }   

                );
            </script>
        </figure>
      Examining the histograms, we see that for large injected values of \(f_{NL}\), the estimator is not able to 
      accurately recover the parameter. Note that the red dashed line is the observed data, which stays the same for each injected 
      \(f_{NL}\) configuration as we do not change the real \(a_{lm}\) data. There are also slight differences in values because 
      the newly generated BBB files have a different <code>dbspace</code> restriction of 5 (meaning bispectrum is only calculated 
      for bin combinations where their difference is is 5 or less).
      
      
      Below is a table of the mean and one sigma spread on \(f_{NL}\) for the 499 sim realizations. 
      We include the relevant parameter configurations, where the ell range is 20-350, and we use the full covariance matrix.
<table border="1" cellpadding="6" cellspacing="0">
  <thead>
    <tr>
      <th>Injected fNL</th>
      <th>alm = alm_bicep + glm + flm</th>
      <th>alm = alm_bicep + flm (no double counting glm)</th>
      <th>alm = glm + flm (no dust or noise)</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>-6.16e+01 &plusmn; 7.65e+02</td>
      <td>-5.58e+01 &plusmn; 7.82e+02</td>
      <td>7.04e-03 &plusmn; 8.85e-01</td>
    </tr>
    <tr>
      <td>1</td>
      <td>-5.19e+01 &plusmn; 7.84e+02</td>
      <td>-5.96e+01 &plusmn; 7.66e+02</td>
      <td>1.02e+00 &plusmn; 1.27e+00</td>
    </tr>
    <tr>
      <td>10</td>
      <td>-2.07e+01 &plusmn; 8.89e+02</td>
      <td>-3.31e+01 &plusmn; 8.76e+02</td>
      <td>2.27e+01 &plusmn; 5.62e+01</td>
    </tr>
    <tr>
      <td>32</td>
      <td>3.93e+02 &plusmn; 2.44e+03</td>
      <td>3.68e+02 &plusmn; 2.45e+03</td>
      <td>4.48e+02 &plusmn; 1.46e+03</td>
    </tr>
    <tr>
      <td>100</td>
      <td>1.24e+04 &plusmn; 4.56e+04</td>
      <td>1.23e+04 &plusmn; 4.59e+04</td>
      <td>1.28e+04 &plusmn; 4.38e+04</td>
    </tr>
    <tr>
      <td>1000</td>
      <td>1.26e+07 &plusmn; 4.40e+07</td>
      <td>1.26e+07 &plusmn; 4.40e+07</td>
      <td>1.27e+07 &plusmn; 4.40e+07</td>
    </tr>
  </tbody>
</table>      
<p>We notice that for low injected \(f_{NL}\), noise and dust dominate the uncertainty. 
    When we remove dust and noise by ignoring the \(a_{lm}^{BICEP}\) term, we see that \(f_{NL}\) is recovered without bias 
    at low values of injected nongaussianity. However, as the injected \(f_{NL}\) increases, the estimator becomes inaccurate, 
    often by several orders of magnitude. Comparing the case with and without noise and dust reveal that this inaccuracy is not caused by noise.</p>
    </section>

  <section>
  <h2>Future Directions</h2>
   <p>
  We need to figure out why larger values of injected \(f_{NL}\) are not recovered, even within the same order of magnitude.

  We may need to revisit how the estimators and bispectrum are calculated, and examine the impact of higher order terms. 
  </p>
  <p>
  Toshiya notes that our current method for calculating biases from the nonlinear terms (eg. \(f_{NL}^2\), \(f_{NL}^3\)) is not correct. 
  The nonlinear term is further multiplied by \(1/r\), \(1/r^2\), etc, and we should update this method. 
  For example, we could extract the nonlinear term alone from the total bispectrum to compute the bias from \(f_{NL}^3\) term.

  Toshiya also notes that there is no bias from the \(f_{NL}^2\) term because 
  \((g_{lm}+f_{NL}f_{lm})^3 = f_{NL}\langle g_{lm}^2 f_{lm}\rangle+f_{NL}^3 \langle f_{lm}^3\rangle\) 
  (reminder that \(g_{lm}\) is the gaussian part of the \(a_{lm}\)'s, and  \(f_{lm}\) is the nongaussian part).
</p>
  </section>
    <section>
        <h2>Appendix</h2>
        <p>All relevant files and directories:
        </p>
        <ul>
            <li>Original BBB bispectrum files: <code>/n/holylfs04/LABS/kovac_lab/users/namikawa/B33y/bispec_bbb/</code></li>
            <li>Newly generated BBB files with injected nonguassianity:<code>/n/holylfs04/LABS/kovac_lab/users/liuto/B33y/</code></li>
            <li>Bispec generator code: <code>/n/home08/liuto/bk_analysis/cmbrectool/bispec/</code></li>
            <li>Fortran library: <code>/n/home02/toshiyan/Lib/f90/</code></li>
            <li>Python code for fNL estimator <code>/n/home08/liuto/GitHub/bispec_project</code></li> 
            
        </ul>
        Fortran files are compiled in <code>cmbrectool</code> using <code>sh install.sh</code>
    </section>
</body>

</html>
