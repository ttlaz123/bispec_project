<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>Revisiting the BBB Bispectrum Project: Cubic Term Recovery</title>
    <link rel="stylesheet" type="text/css" href="style.css">
    <script type="text/x-mathjax-config">
        MathJax.Hub.Config({
            TeX: { equationNumbers: { autoNumber: "AMS" } }
        });
    </script>
    <script type="text/javascript" src="../mathjax/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
    </script>
</head>

<body>
    <script type="text/javascript" src="scripts/pager.js"></script>
    <link rel="stylesheet" type="text/css" href="scripts/pager.css">

    <header>
        <h1>BBB Bispectrum -- Recovering nonlinear fNL</h1>
        <time datetime="2026-01-29" class="published updated">2026 January 29</time> â€”
        Tongtian (Tom) Liu
    </header>

    <hr>

    <section>
        <h2>Introduction</h2>
       <p><strong>Summary:</strong>
        We recover the cubic non-Gaussian term (\(g_{NL} \propto f_{NL}^3\)).
        Previous issues with recovering large \(f_{NL}\) were resolved by correctly isolating the cubic template.
        We now successfully recover the injected signal, though we observe that the uncertainty scales with the signal strength.
    </p>

        <p>This posting builds upon previous updates:</p>
        <ul>
            <li><a href="https://bicep.rc.fas.harvard.edu/bkcmb/analysis_logbook/analysis/20251016_bbb_bispec_revamp/">2025-10-16: Revisiting the BBB Bispectrum Project (Linear Reconstruction)</a></li>
            <li><a href="../20160000_namikawa/20231117_bispec/">2023-11-17: Polarization Bispectrum Analysis</a></li>
            <li><a href="../wip_nonGaussianity/">2022-07-18: Equilateral fNL from B18 95GHz Bispectrum</a></li>
            <li><a href="../20160000_namikawa/20210520_bispec/">2021-05-20: Equilateral B-mode bispectrum analysis</a></li>
            <li><a href="../20200703_bispec/">2020-07-03: Polarization Bispectrum Analysis</a></li>
            <li><a href="../20190805_bispec/">2019-08-05: Polarization Bispectrum Analysis</a></li>
        </ul>
        <p>
            While the simplest inflationary models predict that primordial fluctuations should be nearly Gaussian, 
            any deviations from this are captured by higher-order correlation functions like the bispectrum.
            As discussed in the <a href="https://bicep.rc.fas.harvard.edu/bkcmb/analysis_logbook/analysis/20251016_bbb_bispec_revamp/">previous posting</a>,
            the full bispectrum expansion contains a linear term (\(f_{NL}\)) and a cubic term (\(f_{NL}^3\)).
            In the regime of large non-Gaussianity, the cubic term dominates:
        </p>
        <p>
            We define the auxiliary amplitude \( g_{NL} \equiv f_{NL}^3 / r^3 \). Our updated estimator targets this \(g_{NL}\) parameter directly 
            by using a template constructed from the auto-bispectrum of the non-Gaussian field (\(\langle a^{NG}a^{NG}a^{NG} \rangle\)).
        </p>
    </section>

    <section>
        <h2>Derivation of the Estimators</h2>
        <p>Below is the mathematical framework for the linear and cubic estimators used in this analysis.</p>

        <h3>Derivation of the Bispectrum Amplitude Estimator</h3>

        <p>We begin from the definition of the coefficients,</p>
        \begin{align}
            a^{\rm tot}_{\ell m}
            = \sqrt{r}\,a^{G}_{\ell m}
            + A\,\frac{f_{\rm NL}^{\rm tens}}{r}\,a^{NG}_{\ell m},
            \label{eq:alm-def}
        \end{align}
        <p>where \(a^G\) is a Gaussian realization and \(a^{NG}\) encodes the fixed 
        bispectrum shape of the (tensor) non-Gaussianity.  
        The parameter \(f_{\rm NL}^{\rm tens}\) is the overall amplitude we wish to find.</p>

        <h3>Bispectrum estimator for small fNL</h3>

        <p>The theoretical (reduced, binned) bispectrum may be written as</p>
        \begin{align}
            B_I^{\rm theory}
            \;\propto\;
            \sum_{ m_1  m_2  m_3}
            W_I\,
            \big\langle
                a^{\rm tot}_{\ell_1 m_1}
                a^{\rm tot}_{\ell_2 m_2}
                a^{\rm tot}_{\ell_3 m_3}
            \big\rangle ,
            \label{eq:B-schematic}
        \end{align}
        <p>where \(I\equiv(l_1,l_2,l_3)\) denotes a triple of multipole bins and
        \(W_I\) the matrix from Eq. 15 in the paper draft.</p>

        <p>Inserting Eq.~\eqref{eq:alm-def} from above into the cubic product gives</p>
        \begin{align}
            a^{\rm tot}_1 a^{\rm tot}_2 a^{\rm tot}_3
            &= (\sqrt{r}a_1^G)(\sqrt{r}a_2^G)(\sqrt{r}a_3^G)
            \notag\\
            &\quad
            + 3 (\sqrt{r}a_1^G)(\sqrt{r}a_2^G)
                \Big(A\frac{f_{\rm NL}^{\rm tens}}{r} a_3^{NG}\Big)
            + \mathcal{O}\!\left[(f_{\rm NL}^{\rm tens})^2\right].
            \label{eq:expansion}
        \end{align}

        <p>The first term vanishes upon expectation value,
        \(
        \langle a^G a^G a^G\rangle = 0,
        \)
        and the terms quadratic in \(f_{\rm NL}^{\rm tens}\) are neglected in the weakly 
        non-Gaussian regime.  
        The leading term is therefore the cross term</p>
        \begin{align}
            \big\langle a^{\rm tot}_1 a^{\rm tot}_2 a^{\rm tot}_3 \big\rangle
            =
            3 A\, f_{\rm NL}^{\rm tens}\,
            \big\langle a^{G}_1 a^{G}_2 a^{NG}_3\big\rangle ,
            \label{eq:leading}
        \end{align}
        <p>where the factor of \(r\) has canceled between the Gaussian and non-Gaussian pieces.</p>

        <p>We can then define  \(B_I^{f_{NL}=1}\) to be equal to \(3 A
            \big\langle a^{G}_1 a^{G}_2 a^{NG}_3\big\rangle\), giving</p>
        \begin{align}
            B_I^{\rm theory}
            =
            f_{\rm NL}^{\rm tens}\, B_I^{f_{NL}=1},
            \label{eq:B-linear}
        \end{align}

        <p>The above implies that the observed bispectrum obeys the linear model</p>
        \begin{align}
            b_I
            =
            f_{\rm NL}^{\rm tens}\, b_I^{ f_{\rm NL}^{\rm tens}=1}
            + n_I,
            \label{eq:b-linear}
        \end{align}
        <p>where \(n_I\) is the contribution from noise or other non-gaussian signals, and satisfies
        \(\langle n_I\rangle = 0\).
        The covariance matrix then becomes</p>
        \begin{align}
            \mathrm{Cov}_{IJ}
            =
            \big\langle n_I n_J \big\rangle .
        \end{align}
        
        <h3>Estimator for the amplitude</h3>

        <p>Assuming the \(b_I\) are approximately Gaussian-distributed with mean
        \(f_{\rm NL}^{\rm tens} b_I^{ f_{\rm NL}^{\rm tens}=1}\) and covariance \(\mathrm{Cov}_{IJ}\),
        the log-likelihood for \(f\equiv f_{\rm NL}^{\rm tens}\) is</p>
        \begin{align}
            -2\ln\mathcal{L}(f)
            =
            (b - f b^{ f_{\rm NL}^{\rm tens}=1})^{T}
            \mathrm{Cov}^{-1}
            (b - f b^{ f_{\rm NL}^{\rm tens}=1}).
        \end{align}
        <p>Minimizing with respect to \(f\) gives the unbiased minimum-variance estimator,</p>
        \begin{align}
            \hat{f}_{\rm NL}^{\rm tens}
            =
            \frac{
                {b^{ f_{\rm NL}^{\rm tens}=1}}\mathrm{Cov}^{-1} b
            }{
                {b^{ f_{\rm NL}^{\rm tens}=1}}\mathrm{Cov}^{-1} b^{ f_{\rm NL}^{\rm tens}=1}
            }.
            \label{eq:fNL-general}
        \end{align}

        <p>We rescale the template \(b_I^{ f_{\rm NL}^{\rm tens}=1}\) so that the
        denominator of Eq.~\eqref{eq:fNL-general} equals 1.  
        With this normalization choice, the estimator becomes</p>
        \begin{align}
            f_{\rm NL}^{\rm tens}
            =
            \sum_{I,J}
                b_I^{f_{\rm NL}=1}\,
                \mathrm{Cov}^{-1}_{IJ}\,
                b_J,
            \label{eq:est-fNL-final}
        \end{align}
        <p>which is the estimator quoted in eq 29 of the main text.</p>

        <h3>Full expansion of \(\,a^{\rm tot}_{\ell m}{}^3\) including \(f^2\) and \(f^3\) terms</h3>

        <p>Starting from</p>
        \begin{align}
            a^{\rm tot}_{\ell m}
            = \sqrt{r}\,a^{G}_{\ell m}
            + A\,\frac{f}{r}\,a^{NG}_{\ell m},
            \qquad f \equiv f_{\rm NL}^{\rm tens},
        \end{align}
        <p>the cubic product of three modes (short-hand \(1\equiv(\ell_1,m_1)\), etc.) is</p>
        \begin{align}
            a^{\rm tot}_1 a^{\rm tot}_2 a^{\rm tot}_3
            &= \big(\sqrt{r}\,a^G_1 + A\tfrac{f}{r} a^{NG}_1\big)
            \big(\sqrt{r}\,a^G_2 + A\tfrac{f}{r} a^{NG}_2\big)
            \big(\sqrt{r}\,a^G_3 + A\tfrac{f}{r} a^{NG}_3\big) \notag\\[4pt]
            &= r^{3/2}\,a^G_1 a^G_2 a^G_3
            + 3\,A f \; a^G_1 a^G_2 a^{NG}_3 \notag\\
            &\quad
            + 3\,A^2 f^2\, r^{-3/2}\; a^G_1 a^{NG}_2 a^{NG}_3
            + A^3 f^3\, r^{-3}\; a^{NG}_1 a^{NG}_2 a^{NG}_3.
            \label{eq:a3-full}
        \end{align}
        <p>Taking the expectation value and noting that terms with an even number of non-gaussian contributions vanish under expectation, we obtain the leading and cubic contributions:</p>
        \begin{align}
            \big\langle a^{\rm tot}_1 a^{\rm tot}_2 a^{\rm tot}_3 \big\rangle
            &= 3 A f \;\big\langle a^G_1 a^G_2 a^{NG}_3\big\rangle
            \;+\; A^3 f^3 r^{-3}\;\big\langle a^{NG}_1 a^{NG}_2 a^{NG}_3\big\rangle.
            \label{eq:exp-expected}
        \end{align}

        <p>Define the binned templates (or reduced bispectra) corresponding to each power:</p>
        \begin{align}
            B_I^{(1)} &\;\equiv\; 3A\;\sum_{m_1 m_2 m_3} W_I\;\big\langle a^G_1 a^G_2 a^{NG}_3\big\rangle,\\
            B_I^{(2)} &\;\equiv\; 0,\\
            B_I^{(3)} &\;\equiv\; A^3 \;\sum_{m_1 m_2 m_3} W_I\;\big\langle a^{NG}_1 a^{NG}_2 a^{NG}_3\big\rangle,
        \end{align}
        <p>so that the theoretical binned bispectrum reads</p>
        \begin{align}
            B_I^{\rm theory}(f)= f\,B_I^{(1)}  + \frac{f^3}{r^3}\,B_I^{(3)}.
            \label{eq:B-theory-full}
        \end{align}

        <p>Equivalently, when we run the identical filtering/binnning pipeline on skies
        we obtain</p>
        \begin{align}
            b_I^{\rm theory}(f)= f\,b_I^{(1)} + \frac{f^3}{r^3}\,b_I^{(3)}.
        \end{align}


        <h3>Estimator when only the \(f^3\) term is present</h3>

        <p>Assuming that \(f\) is large, we can ignore the linear term so the data follows:</p>
        \begin{equation}
            b_I = \frac{f^3}{r^3}\, b_I^{(3)} + n_I,
            \qquad \langle n_I\rangle = 0,\qquad \mathrm{Cov}_{IJ}=\langle n_I n_J\rangle.
            \label{eq:only-cubic-r}
        \end{equation}

        <p>Here, we assume the noise and covariance matrix can be constructed the same as the linear case, but these assumptions may need to be revisited.
            </p>
        \begin{equation}
            g \equiv \frac{f^3}{r^3} \quad\Longrightarrow\quad b_I = g\, b_I^{(3)} + n_I.
            \label{eq:g-def-r}
        \end{equation}
        <p>We have the same equation as the original linear case, except we have \(g\) instead of \(f\), and \(b^{(3)}_I\) contains the  
            \(\big\langle a^{NG}_1 a^{NG}_2 a^{NG}_3\big\rangle\) terms rather than the \(\big\langle a^G_1 a^G_2 a^{NG}_3\big\rangle\) terms.</p>
        \begin{equation}
            g_{\rm NL}^{\rm tens} =\sum_{I,J}b_I^{(3)f_{\rm NL}=1}\mathrm{Cov}^{-1}_{IJ}b_J^{(3)}
            \label{eq:est-fNL-cubic}
        \end{equation}
        <p>To recover \(f_{NL}\), we have \(f=rg^{1/3}\).</p>
    </section>

    <section>
    <h2>Reproducing Linear Results</h2>
     <p>
      We previously confirmed that the estimator successfully recovers the linear \(f_{NL}\) for small injected values (and null tests).
      The details and plots for the linear reconstruction can be found in the previous posting: 
      <a href="https://bicep.rc.fas.harvard.edu/bkcmb/analysis_logbook/analysis/20251016_bbb_bispec_revamp/">2025-10-16: Revisiting the BBB Bispectrum Project</a>.
     </p>
    </section>

    <section>
    <h2>Recovering the Cubic Term \(g_{NL}\)</h2>
    <p>
        We updated the pipeline to generate a cubic template by computing the auto-bispectrum of the pure non-Gaussian simulation component.
        We then injected signals with varying \(f_{NL}\) into simulations and attempted to recover the amplitude.
    </p>
    <p>
        The plots below show the recovered \(g_{NL}\) (and the derived \(f_{NL}\)) for different injected values.
        We test two cases:
        <ul>
            <li><strong>With Noise:</strong> Standard BICEP noise + Dust included.</li>
            <li><strong>No Noise:</strong> Pure signal simulations (\(a_{lm} = \sqrt{r} a^G + f_{NL} a^{NG}\)).</li>
        </ul>
    </p>

        <figure>
            <img alt="Recovered gNL histograms" id="gnl" src="#" width="900" height="600"
                onerror="javascript:this.src='dne.png'" />
            <figcaption>
                Histograms of the recovered \(g_{NL}\) parameter (left) and the derived \(f_{NL}\) distribution (right).
                Note that for the "No Noise" case, we simply remove the BICEP noise/dust realization from the input map.
            </figcaption>

            <script type="text/javascript">
                pager.link("#gnl", {
                    'Injected fNL|scaling':[
                        'fNL = 0|0000',
                        'fNL = 1|0001',
                        'fNL = 10|0010',
                        'fNL = 32|0032',
                        'fNL = 100|0100',
                        'fNL = 1000|1000',
                    ],
                    'Simulation Type|simtype': [
                        'Standard (Noise+Dust)|gnl_figs',
                        'No Noise (Signal Only)|gnl_nonoise',
                    ],
                    'Bin Num|bn': [
                        '9|9',
                    ],
                    'Ell Range|oL':[
                        '20-350|20-350',
                    ],
                    'Frequency|nu':[
                        '100|100'
                    ],
                }, function (params) {
                    let dirbase = '/liuto/home/GitHub/bispec_project/';
                    dirbase = dirbase + params.simtype + '/'
                    
                    // Filename construction
                    let filename = 'b3d_1var_nu' + params.nu + 
                                '_lx0_nobl_lcdm' + 
                                '_dp1102_oL' + params.oL + 
                                '_b' + params.bn + 
                                '_gnl_fnl' + params.scaling +
                                '_diagFalse'; 
                                
                    let filepath = dirbase + filename + '.png'
                    console.log(filepath)
                    return filepath;
                });

                pager.setparams({ 
                    'bn': '9',
                    'oL': '20-350',
                    'simtype': 'gnl_figs',
                    'nu': '100',
                    'scaling':'1000',
                });
            </script>
        </figure>

    <h3>Discussion of Results</h3>
    <p>
        The results show that we can now accurately recover the central value of the injected \(f_{NL}\) across orders of magnitude 
        (e.g., recovering \(10^9\) for input \(1000\), and \(10^6\) for input \(100\)).
    </p>
    <p>
        For large injected signals (\(f_{NL} \gtrsim 100\)), the spread of the estimator (\(\sigma_g\)) is not constant; rather, it scales with the signal strength 
        (\(\sigma_g \approx 1.5 \times \langle g \rangle\)). 
        Removing detector noise ("No Noise" plots) does not reduce this spread. 
        For smaller injected signals, the uncertainty remains relatively constant due to observation noise and dust, and removing these effects 
        dramatically decreases the uncertainty.
    </p>
    <p>
        We believe this uncertainty scaling could be caused by the variance of the limited field size itself, 
        that the variance of the estimator is dominated by the fluctuations of the \(a^{NG}\) field rather than any noise source.
         However, it could also be due to 
        inaccurate assumptions about how to model that uncertainty and propogating it through the derivation of the covariance matrix.
        Our current estimator uses a covariance matrix derived under the null hypothesis \((f_{\rm NL}=0)\). 
        This approximation assumes that the covariance is independent of the parameter value and dominated by Gaussian terms 
        (\(\langle a^G a^G a^G \rangle \sim 0\)). 
        However, in the high-signal regime, the variance contribution from the non-Gaussian realizations becomes significant.
    </p>
    <p>
        In the \(f_{NL}\) (derived) histograms, we see a bimodal distribution with peaks near \(\pm f_{NL}\).
        This is a mathematical artifact of taking the cube root of a noisy variable centered near zero, but it is curious that the positive and negative 
        peaks are \(\pm f_{NL}\).
        
    </p>
    <p>
        
        
    </p>
    </section>

    <section>
    <h2>Future Directions</h2>
   <p> We should revisit the derivation of the estimator covariance matrix. 
    The current weighting scheme assumes linear noise (fixed covariance based on Gaussian fields), 
    whereas the actual variance depends on the cubic signal strength. 
    To accurately capture the uncertainties in the high-signal regime, 
    we should re-derive the covariance matrix to include signal-dependent terms. 
    Additionally, Toshiya has suggested investigating the impact of varying the tensor-to-scalar ratio (r) on signal recovery.
    He has also suggested constraining \(f_{\rm NL}\) directly using the (BB) power spectrum, as the non-Gaussian field also sources power at the 2-point level,
    although he noted that may be outside the scope of the current project.
    </section>

    <section>
        <h2>Appendix</h2>
        <p>Relevant files and directories:</p>
        <ul>
            <li>Original BBB bispectrum files: <code>/n/holylfs04/LABS/kovac_lab/users/namikawa/B33y/bispec_bbb/</code></li>
            <li>Newly generated BBB files with injected nonguassianity: <code>/n/holylfs04/LABS/kovac_lab/users/liuto/B33y/</code></li>
            <li>Estimator Code: <code>/n/home08/liuto/GitHub/bispec_project</code></li> 
            <li>Cubic Plots (With Noise): <code>.../bispec_project/gnl_figs/</code></li> 
            <li>Cubic Plots (No Noise): <code>.../bispec_project/gnl_figs_nonoise/</code></li> 
            <li>Bispec generator code: <code>/n/home08/liuto/bk_analysis/cmbrectool/bispec/</code></li>
            <li>Fortran library: <code>/n/home02/toshiyan/Lib/f90/</code></li>
        </ul>
    </section>
</body>
</html>